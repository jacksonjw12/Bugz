<!DOCTYPE html>
<html>
  <head>
    <title>ğŸBugzğŸ</title>
    <link rel="stylesheet" type="text/css" href="index.css">
   
  </head>
  <body>

  <div id="menu" style="display:block">
    <h1> Bug Game </h1>

    <div class="introContainer">
      <div class="intro">
        <button onclick="newGame()"> New Game </button>
        <hr>
        <h2 id="joinGameWithCode"> Join Game with Code </h2>
        <div class="joinGameInput">
          <input type="text" id="joinGameCode" />
          <button onclick="joinWithCode()"> Join </button>
        </div>
        <div class="userIdContainer">UID: <span id="userId"></span> <span class="idRefresh" onClick="requestNewId()">ğŸ”</span></div>
      </div>  
    </div>
  </div>

  <div id="room" style="display:none">
    <div class="introContainer">
     <div class="intro waitingRoom">

      <h1 id="roomCode"> Waiting room:</h1>
       <h2> Players </h2>
       <ul id="playerList" class="playerList">
         
       </ul>
       <button id="startButton" onclick="startGame()"> Start Game </button>


        <button id="leaveButton" onClick="leaveRoom()"> Leave Room </button>

      </div>
    </div>
  </div>


  <div id="game" style="display:none">
    <div class="overlay">
    <div id="turnIndicator">Your turn</div>
    <div id="forfeit" onClick="leaveGame()">Leave game (forfeit)</div>

      <div class="footer">
        <div id="bugButtons" class = "bugButtons">
            
          <div id="ğŸButton" onClick="Grid.instance.focusBug('ğŸ')" class="bugButton selected" >
            <div id="ğŸAmount" class="numBugs">2</div>
            <div class="bug">ğŸ</div>
          </div>

          <div id="ğŸButton" class="bugButton hiddenBugContainer" >
            <div id="ğŸAmount" class="numBugs hiddenBug">1</div>
            <div class="bug hiddenBug">ğŸ</div>
          </div>

        </div>
      </div>
    </div>
    <canvas id="canvas"></canvas>
  </div>
  </body>
  <script src="/socket.io/socket.io.js"></script>
  <script>

  const hide = (id) => {document.getElementById(id).style.display = "none"}
  const show = (id) => {document.getElementById(id).style.display = "block"}

  let state = {id: ''}
  let currentView = "menu";
  function updateState(newState) {
    window.userId = newState.id;

    let newView = currentView;
    if(newState.room) {
      newView = newState.room.game ? 'game' : 'room';
    }
    else {
      newView = 'menu'
    }
    console.log({newView})

    state = newState;
    if(newView != currentView) {
     hide(currentView);
    }
    if(newView == 'menu') {
     document.getElementById('userId').style.background = `#${newState.id}`

      document.getElementById('userId').innerHTML = newState.id;

    }
    else if(newView == 'room') {
      Room.applyNewRoomState(state.room)
      
    }
    else if(newView == 'game') {
      Grid.instance.applyNewGameState(state.room.game);
    }

    show(newView);
    currentView = newView;

  }
  
  </script>

    <script src="utils.js"></script>
    <script src="Grid.js"></script>
    <script src="Room.js"></script>

    <script src="main.js"></script>
</html>